<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todoist Clone Tutorial (PHP, MySQL, Alpine.js, Tailwind)</title>
    <!-- Include Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include Alpine.js via CDN (defer ensures it runs after HTML is parsed) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
      /* Add some basic styles for readability */
      body {
        font-family: sans-serif;
        line-height: 1.6;
        padding: 20px;
        background-color: #f7fafc; /* Tailwind gray-100 */
      }
      h1,
      h2,
      h3 {
        margin-bottom: 0.5em;
        font-weight: 600; /* Tailwind semibold */
      }
      h1 {
        font-size: 2.25rem; /* Tailwind text-4xl */
      }
      h2 {
        font-size: 1.875rem; /* Tailwind text-3xl */
        border-bottom: 1px solid #e2e8f0; /* Tailwind gray-300 */
        padding-bottom: 0.2em;
        margin-top: 1.5em;
      }
      h3 {
        font-size: 1.5rem; /* Tailwind text-2xl */
        margin-top: 1em;
      }
      p {
        margin-bottom: 1em;
      }
      /* Base style for inline code */
      code {
        background-color: #edf2f7; /* Tailwind gray-200 */
        padding: 0.2em 0.4em;
        border-radius: 3px;
        font-family: monospace;
        color: #4a5568; /* Tailwind gray-700 - Ensure inline code has dark text */
      }
      /* Style for code blocks */
      pre {
        background-color: #2d3748; /* Tailwind gray-800 */
        color: #e2e8f0; /* Tailwind gray-300 - Default text color for pre */
        padding: 1em;
        border-radius: 5px;
        overflow-x: auto;
        margin-bottom: 1em;
        position: relative; /* Needed for absolute positioning of the copy button */
      }
      /* Specific styling for code elements INSIDE pre blocks */
      pre code {
        background-color: transparent !important; /* No background override */
        color: inherit !important; /* Inherit text color from pre */
        padding: 0 !important; /* Reset padding */
        border-radius: 0 !important; /* Reset border-radius */
        font-family: monospace; /* Ensure font */
      }
      /* Ensure spans within pre code use their Tailwind colors */
      pre code span[class*="text-"] {
        /* Tailwind classes should handle this */
      }
      /* Style for the copy button */
      pre .copy-button {
        position: absolute;
        top: 0.5rem; /* Adjust as needed */
        right: 0.5rem; /* Adjust as needed */
        background-color: #4a5568; /* gray-700 */
        color: #e2e8f0; /* gray-300 */
        border: none;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem; /* text-xs */
        border-radius: 0.25rem; /* rounded */
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s ease-in-out, background-color 0.2s ease-in-out;
      }
      pre:hover .copy-button {
         opacity: 1;
      }
      pre .copy-button:hover {
        background-color: #718096; /* gray-600 */
      }
       pre .copy-button.copied {
        background-color: #48bb78; /* green-500 */
        color: white;
      }

      .stage-section {
        background-color: #ffffff; /* Tailwind white */
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06); /* Tailwind shadow */
        margin-bottom: 2em;
      }
      ul {
        list-style: disc;
        margin-left: 20px;
        margin-bottom: 1em;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto max-w-4xl">
      <h1 class="text-4xl font-bold text-center text-blue-600 mb-8">
        Build Your Own Todoist Clone!
      </h1>

      <p class="text-lg text-center mb-6">
        A beginner-friendly tutorial using PHP, MySQL (XAMPP), Alpine.js, and
        Tailwind CSS.
      </p>

      <p class="mb-6">
        Welcome! This tutorial will guide you through building a simple
        Todoist-like web application in five manageable stages. We'll start with
        basic HTML and styling, gradually adding PHP for dynamic content, a
        database for persistence, JavaScript for interactivity, and finally user
        authentication and routing to create a multi-page application (MPA).
      </p>

      <p class="mb-8">
        <strong>Prerequisites:</strong> Basic understanding of HTML. Some
        familiarity with programming concepts is helpful but not strictly
        required. You'll need
        <a
          href="https://www.apachefriends.org/"
          target="_blank"
          class="text-blue-500 hover:underline"
          >XAMPP</a
        >
        installed (or a similar local server environment with PHP and MySQL).
      </p>

      <!-- Stage 1: Basic HTML & Tailwind -->
      <div class="stage-section" id="stage-1">
        <h2 class="text-3xl mb-4">
          Stage 1: Static Foundation (HTML & Tailwind CSS)
        </h2>
        <p>
          Let's start by creating the basic structure of our app using HTML and
          styling it with Tailwind CSS. At this stage, the task list will be
          static (hardcoded in the HTML).
        </p>

        <h3 class="text-2xl mt-4 mb-2">Goals:</h3>
        <ul>
          <li>Set up the basic HTML structure.</li>
          <li>Apply Tailwind CSS classes for layout and styling.</li>
          <li>Display a static list of tasks.</li>
        </ul>

        <h3 class="text-2xl mt-4 mb-2">File Structure (Stage 1):</h3>
        <pre><code>
project-root/
└── index.html
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Instructions:</h3>
        <ol class="list-decimal ml-6 mb-4">
          <li>Create a folder for your project (e.g., `todoist-clone`).</li>
          <li>Inside this folder, create a file named `index.html`.</li>
          <li>
            Add the following HTML structure to `index.html`. We're including
            Tailwind via CDN in the `&lt;head&gt;` section.
          </li>
        </ol>

        <h3 class="text-2xl mt-4 mb-2">Code: `index.html`</h3>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code>
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Simple Todo App&lt;/title&gt;
    &lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body class="bg-gray-100"&gt;
    &lt;div class="container mx-auto max-w-lg mt-10 bg-white p-6 rounded shadow-md"&gt;
        &lt;h1 class="text-2xl font-bold mb-4 text-center"&gt;My Tasks&lt;/h1&gt;

        &lt;!-- Task Input Form (Static Structure) --&gt;
        &lt;div class="mb-4"&gt;
            &lt;input type="text" placeholder="Add a new task" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300"&gt;
            &lt;!-- We'll make this button work later --&gt;
            &lt;button class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"&gt;
                Add Task
            &lt;/button&gt;
        &lt;/div&gt;

        &lt;!-- Task List (Static) --&gt;
        &lt;ul&gt;
            &lt;!-- Sample Task 1 (Completed) --&gt;
            &lt;li class="flex justify-between items-center p-2 border-b border-gray-200"&gt;
                &lt;span class="line-through text-gray-500"&gt;Learn HTML&lt;/span&gt;
                &lt;div&gt;
                    &lt;!-- Buttons (non-functional yet) --&gt;
                    &lt;button class="text-green-500 hover:text-green-700 mr-2"&gt;✓&lt;/button&gt;
                    &lt;button class="text-red-500 hover:text-red-700"&gt;✗&lt;/button&gt;
                &lt;/div&gt;
            &lt;/li&gt;
            &lt;!-- Sample Task 2 (Incomplete) --&gt;
            &lt;li class="flex justify-between items-center p-2 border-b border-gray-200"&gt;
                &lt;span&gt;Learn Tailwind CSS&lt;/span&gt;
                &lt;div&gt;
                    &lt;!-- Buttons (non-functional yet) --&gt;
                    &lt;button class="text-gray-400 hover:text-green-500 mr-2"&gt;✓&lt;/button&gt;
                    &lt;button class="text-red-500 hover:text-red-700"&gt;✗&lt;/button&gt;
                &lt;/div&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

        <p>
          Open this `index.html` file in your browser. You should see a basic,
          styled task list. Nothing works yet, but we have our visual
          foundation!
        </p>
      </div>

      <!-- Stage 2: Introduce PHP -->
      <div class="stage-section" id="stage-2">
        <h2 class="text-3xl mb-4">Stage 2: Dynamic Rendering with PHP</h2>
        <p>
          Now, let's replace the static task list with dynamic content generated
          by PHP. We'll use a simple PHP array to hold the tasks for now,
          introducing server-side rendering.
        </p>

        <h3 class="text-2xl mt-4 mb-2">Goals:</h3>
        <ul>
          <li>Rename `index.html` to `index.php`.</li>
          <li>Define tasks in a PHP array.</li>
          <li>Use a PHP loop to render the task list dynamically.</li>
          <li>
            Ensure XAMPP (or equivalent) is running and serving the `.php` file.
          </li>
        </ul>

        <h3 class="text-2xl mt-4 mb-2">File Structure (Stage 2):</h3>
        <pre><code>
project-root/
└── index.php  <span class="text-yellow-400"><-- Renamed from index.html</span>
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Instructions:</h3>
        <ol class="list-decimal ml-6 mb-4">
          <li>Make sure XAMPP (or your local server) is running Apache.</li>
          <li>
            Place your `project-root` folder inside XAMPP's `htdocs` directory
            (e.g., `C:/xampp/htdocs/todoist-clone/`).
          </li>
          <li>Rename `index.html` to `index.php`.</li>
          <li>Modify `index.php` to include the PHP code below.</li>
          <li>
            Access the file through your browser via
            `http://localhost/todoist-clone/` (adjust the path if needed).
          </li>
        </ol>

        <h3 class="text-2xl mt-4 mb-2">Code: `index.php` (Modifications)</h3>
        <p>
          Replace the static `&lt;ul&gt;` section in your `index.php` file with
          the following PHP block:
        </p>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">&lt;?php
// index.php

// Define tasks in a PHP array (temporary data source)
$tasks = [
    ['id' => 1, 'title' => 'Learn basic PHP', 'completed' => true],
    ['id' => 2, 'title' => 'Understand PHP loops', 'completed' => false],
    ['id' => 3, 'title' => 'Set up XAMPP', 'completed' => true],
];

// We will add functions for adding/deleting later
// function addTask($title) { /* Add logic later */ }
// function deleteTask($id) { /* Add logic later */ }
// function toggleTask($id) { /* Add logic later */ }

?&gt;

&lt;!-- ... (Keep the head and top part of the body) ... --&gt;

&lt;body class="bg-gray-100"&gt;
    &lt;div class="container mx-auto max-w-lg mt-10 bg-white p-6 rounded shadow-md"&gt;
        &lt;h1 class="text-2xl font-bold mb-4 text-center"&gt;My Tasks&lt;/h1&gt;

        &lt;!-- Task Input Form (Still static HTML for now) --&gt;
        &lt;div class="mb-4"&gt;
            &lt;input type="text" placeholder="Add a new task" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300"&gt;
            &lt;button class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"&gt;
                Add Task
            &lt;/button&gt;
        &lt;/div&gt;

        &lt;!-- Task List (Dynamic PHP Rendering) --&gt;
        &lt;ul&gt;
            &lt;?php if (!empty($tasks)): ?&gt;
                &lt;?php foreach ($tasks as $task): ?&gt;
                    &lt;li class="flex justify-between items-center p-2 border-b border-gray-200"&gt;
                        &lt;span class="&lt;?php echo $task['completed'] ? 'line-through text-gray-500' : ''; ?&gt;"&gt;
                            &lt;?php echo htmlspecialchars($task['title']); // Use htmlspecialchars for security ?&gt;
                        &lt;/span&gt;
                        &lt;div&gt;
                            &lt;!-- Buttons (Still non-functional links/placeholders) --&gt;
                            &lt;a href="#" class="&lt;?php echo $task['completed'] ? 'text-gray-400' : 'text-green-500'; ?&gt; hover:text-green-700 mr-2"&gt;✓&lt;/a&gt; &lt;!-- Link placeholder --&gt;
                            &lt;a href="#" class="text-red-500 hover:text-red-700"&gt;✗&lt;/a&gt; &lt;!-- Link placeholder --&gt;
                        &lt;/div&gt;
                    &lt;/li&gt;
                &lt;?php endforeach; ?&gt;
            &lt;?php else: ?&gt;
                &lt;li class="text-gray-500 text-center p-2"&gt;No tasks yet!&lt;/li&gt;
            &lt;?php endif; ?&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

        <p>
          Now, when you view `http://localhost/todoist-clone/` in your browser,
          the task list should be generated from the PHP array. Changing the
          array in the code will change the list on refresh.
        </p>
      </div>

      <!-- Stage 3: Database Integration (XAMPP, MySQL, CRUD) -->
      <div class="stage-section" id="stage-3">
        <h2 class="text-3xl mb-4">
          Stage 3: Database Persistence (MySQL & CRUD)
        </h2>
        <p>
          It's time to store our tasks permanently! We'll set up a MySQL
          database using XAMPP's phpMyAdmin and connect our PHP application to
          it. We'll implement basic CRUD (Create, Read, Update, Delete)
          operations.
        </p>

        <h3 class="text-2xl mt-4 mb-2">Goals:</h3>
        <ul>
          <li>Create a MySQL database and a `tasks` table using phpMyAdmin.</li>
          <li>Create configuration and function files in PHP.</li>
          <li>Connect PHP to the MySQL database.</li>
          <li>
            Implement functions to:
            <ul>
              <li>Read tasks from the database.</li>
              <li>Add new tasks to the database.</li>
              <li>Update task completion status in the database.</li>
              <li>Delete tasks from the database.</li>
            </ul>
          </li>
          <li>
            Modify `index.php` to use these functions and interact with the
            database.
          </li>
        </ul>

        <h3 class="text-2xl mt-4 mb-2">File Structure (Stage 3):</h3>
        <pre>
<button class="copy-button" x-data="{}" @click="
    const codeElement = $event.target.closest('pre').querySelector('code');
    navigator.clipboard.writeText(codeElement.innerText).then(() => {
        $event.target.innerText = 'Copied!';
        $event.target.classList.add('copied');
        setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
    }).catch(err => console.error('Copy failed', err));
">Copy</button><code>
project-root/
├── config/
│   └── database.php      <span class="text-lime-400"><-- New</span>
├── includes/
│   └── functions.php     <span class="text-lime-400"><-- New</span>
├── public/               <span class="text-lime-400"><-- New (Best practice: keep web accessible files here)</span>
│   └── index.php         <span class="text-yellow-400"><-- Moved & Modified</span>
└── .htaccess             <span class="text-lime-400"><-- Optional: For cleaner URLs later (if needed)</span>
</code></pre>
        <p class="text-sm italic">
          Note: We've moved `index.php` into a `public` folder. You'll need to
          configure your Apache server (or adjust your URL) to point to this
          `public` directory as the document root for
          `http://localhost/todoist-clone/`. For simplicity in XAMPP, you might
          initially keep `index.php` in the root and adjust paths, but using a
          `public` folder is better practice.
        </p>

        <h3 class="text-2xl mt-4 mb-2">Database Setup (phpMyAdmin):</h3>
        <ol class="list-decimal ml-6 mb-4">
          <li>
            Open phpMyAdmin (usually accessible via the XAMPP control panel or
            `http://localhost/phpmyadmin`).
          </li>
          <li>Create a new database (e.g., `todoist_clone_db`).</li>
          <li>Select the new database and go to the SQL tab.</li>
          <li>Run the following SQL command to create the `tasks` table:</li>
        </ol>
        <pre>
<button class="copy-button" x-data="{}" @click="
    const codeElement = $event.target.closest('pre').querySelector('code');
    navigator.clipboard.writeText(codeElement.innerText).then(() => {
        $event.target.innerText = 'Copied!';
        $event.target.classList.add('copied');
        setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
    }).catch(err => console.error('Copy failed', err));
">Copy</button><code class="language-sql">CREATE TABLE tasks (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Code: `config/database.php`</h3>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// config/database.php

// Database configuration constants
define('DB_HOST', 'localhost');        // Or your DB host (usually localhost for XAMPP)
define('DB_USER', 'root');            // Your MySQL username (default 'root' for XAMPP)
define('DB_PASS', '');                // Your MySQL password (default empty for XAMPP)
define('DB_NAME', 'todoist_clone_db'); // The database name you created

// Function to establish database connection (using mysqli)
function connectDB() {
    // Create connection
    $conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

    // Check connection
    if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error); // Basic error handling
    }

    return $conn;
}

// You might want to add error reporting settings here for development
// error_reporting(E_ALL);
// ini_set('display_errors', 1);

?&gt;
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Code: `includes/functions.php`</h3>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// includes/functions.php

// Make sure to include the database configuration
// Note the path adjustment if index.php is in public/
require_once __DIR__ . '/../config/database.php';

// Function to get all tasks from the database
function getAllTasks() {
    $conn = connectDB();
    $tasks = []; // Initialize empty array

    // SQL query to select all tasks, ordered by creation date
    $sql = "SELECT id, title, completed FROM tasks ORDER BY created_at DESC";
    $result = $conn->query($sql);

    if ($result && $result->num_rows > 0) {
        // Fetch all results into an associative array
        $tasks = $result->fetch_all(MYSQLI_ASSOC);
    }

    $conn->close(); // Close the connection
    return $tasks;
}

// Function to add a new task
// Takes the task title as input
function addTask($title) {
    $conn = connectDB();
    $title = $conn->real_escape_string(trim($title)); // Sanitize input

    if (!empty($title)) {
        // SQL query to insert a new task
        $sql = "INSERT INTO tasks (title) VALUES ('$title')";
        $conn->query($sql);
        // Basic error checking could be added here: if ($conn->error) { ... }
    }

    $conn->close();
}

// Function to delete a task by its ID
function deleteTask($id) {
    $conn = connectDB();
    $id = (int)$id; // Cast to integer for security

    if ($id > 0) {
        // SQL query to delete a task
        $sql = "DELETE FROM tasks WHERE id = $id";
        $conn->query($sql);
        // Basic error checking could be added here
    }

    $conn->close();
}

// Function to toggle the completion status of a task by its ID
function toggleTask($id) {
    $conn = connectDB();
    $id = (int)$id; // Cast to integer

    if ($id > 0) {
        // SQL query to toggle the 'completed' status
        // Flips the boolean value (0 becomes 1, 1 becomes 0)
        $sql = "UPDATE tasks SET completed = NOT completed WHERE id = $id";
        $conn->query($sql);
        // Basic error checking could be added here
    }

    $conn->close();
}

?>
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">
          Code: `public/index.php` (Modifications)
        </h3>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/index.php

// Include necessary files
// Note the path adjustment because index.php is inside 'public'
require_once __DIR__ . '/../includes/functions.php';

// --- Form Handling ---
// Check if the request method is POST (form submitted)
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Check if the 'action' field is set
    if (isset($_POST['action'])) {
        $action = $_POST['action'];
        $taskId = isset($_POST['task_id']) ? (int)$_POST['task_id'] : 0;

        switch ($action) {
            case 'add':
                if (!empty($_POST['task_title'])) {
                    addTask($_POST['task_title']);
                }
                break;
            case 'delete':
                if ($taskId > 0) {
                    deleteTask($taskId);
                }
                break;
            case 'toggle':
                    if ($taskId > 0) {
                    toggleTask($taskId);
                    }
                break;
        }

        // Redirect back to the index page to prevent form resubmission on refresh
        // This is a common pattern called Post/Redirect/Get (PRG)
        header("Location: index.php");
        exit; // Important to stop script execution after redirection
    }
}

// --- Data Fetching ---
// Get all tasks from the database AFTER any potential modifications
$tasks = getAllTasks();

?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;!-- ... (keep head content: meta, title, tailwind cdn) ... --&gt;
    &lt;title&gt;Todo App - DB&lt;/title&gt;
    &lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body class="bg-gray-100"&gt;
    &lt;div class="container mx-auto max-w-lg mt-10 bg-white p-6 rounded shadow-md"&gt;
        &lt;h1 class="text-2xl font-bold mb-4 text-center"&gt;My Tasks&lt;/h1&gt;

        &lt;!-- Task Input Form - Now functional! --&gt;
        &lt;form action="index.php" method="POST" class="mb-4"&gt;
            &lt;input type="hidden" name="action" value="add"&gt; &lt;!-- Hidden field to specify action --&gt;
            &lt;input type="text" name="task_title" placeholder="Add a new task" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300" required&gt;
            &lt;button type="submit" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"&gt;
                Add Task
            &lt;/button&gt;
        &lt;/form&gt;

        &lt;!-- Task List (Dynamic from Database) --&gt;
        &lt;ul&gt;
            &lt;?php if (!empty($tasks)): ?&gt;
                &lt;?php foreach ($tasks as $task): ?&gt;
                    &lt;li class="flex justify-between items-center p-2 border-b border-gray-200"&gt;
                        &lt;span class="&lt;?php echo $task['completed'] ? 'line-through text-gray-500' : ''; ?&gt;"&gt;
                            &lt;?php echo htmlspecialchars($task['title']); ?&gt;
                        &lt;/span&gt;
                        &lt;div class="flex space-x-2"&gt;
                            &lt;!-- Toggle Form --&gt;
                            &lt;form action="index.php" method="POST" class="inline-block"&gt;
                                &lt;input type="hidden" name="action" value="toggle"&gt;
                                &lt;input type="hidden" name="task_id" value="&lt;?php echo $task['id']; ?&gt;"&gt;
                                &lt;button type="submit" class="&lt;?php echo $task['completed'] ? 'text-gray-400' : 'text-green-500'; ?&gt; hover:text-green-700"&gt;✓&lt;/button&gt;
                            &lt;/form&gt;
                                &lt;!-- Delete Form --&gt;
                            &lt;form action="index.php" method="POST" class="inline-block"&gt;
                                &lt;input type="hidden" name="action" value="delete"&gt;
                                &lt;input type="hidden" name="task_id" value="&lt;?php echo $task['id']; ?&gt;"&gt;
                                &lt;button type="submit" class="text-red-500 hover:text-red-700" onclick="return confirm('Are you sure you want to delete this task?');"&gt;✗&lt;/button&gt;
                            &lt;/form&gt;
                        &lt;/div&gt;
                    &lt;/li&gt;
                &lt;?php endforeach; ?&gt;
            &lt;?php else: ?&gt;
                &lt;li class="text-gray-500 text-center p-2"&gt;No tasks yet! Add one above.&lt;/li&gt;
            &lt;?php endif; ?&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

        <p>
          Now, your application reads and writes tasks to the database. Adding,
          completing (toggling), and deleting tasks involves submitting forms,
          which PHP processes, modifies the database, and then reloads the page
          to show the updated list (thanks to the PRG pattern).
        </p>
      </div>

      <!-- Stage 4: Frontend Interactivity with Alpine.js -->
      <div class="stage-section" id="stage-4">
        <h2 class="text-3xl mb-4">
          Stage 4: Frontend Interactivity (Alpine.js)
        </h2>
        <p>
          Currently, every action (completing, deleting) requires a full page
          reload. Let's use Alpine.js, a lightweight JavaScript framework, to
          handle some interactions directly in the browser for a smoother user
          experience. We'll focus on toggling task completion without a page
          refresh (using AJAX/Fetch API behind the scenes).
        </p>

        <h3 class="text-2xl mt-4 mb-2">Goals:</h3>
        <ul>
          <li>Include Alpine.js library.</li>
          <li>
            Modify the task list rendering to use Alpine.js directives
            (`x-data`, `x-for`, `@click`).
          </li>
          <li>
            Create a new PHP endpoint (e.g., `api.php`) to handle AJAX requests
            for toggling tasks.
          </li>
          <li>
            Use JavaScript's `fetch` API within Alpine.js to call the PHP
            endpoint.
          </li>
          <li>
            Update the task's appearance instantly on the frontend upon
            successful completion toggle.
          </li>
          <li>
            (Optional) Apply similar logic for deleting tasks without page
            reload.
          </li>
        </ul>

        <h3 class="text-2xl mt-4 mb-2">File Structure (Stage 4):</h3>
        <pre><code>
project-root/
├── config/
│   └── database.php
├── includes/
│   └── functions.php
├── public/
│   ├── index.php         <span class="text-yellow-400"><-- Modified for Alpine.js</span>
│   └── api.php           <span class="text-lime-400"><-- New: Handles AJAX requests</span>
└── .htaccess             <span class="text-gray-500"><-- (Optional)</span>
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Instructions:</h3>
        <ol class="list-decimal ml-6 mb-4">
          <li>
            Ensure Alpine.js is included (via CDN) in `public/index.php`. Add
            `defer` to the script tag.
          </li>
          <li>
            Create `public/api.php` to handle task updates via Fetch/AJAX.
          </li>
          <li>
            Modify `public/index.php` to integrate Alpine.js for managing the
            task list state and interactions.
          </li>
        </ol>

        <h3 class="text-2xl mt-4 mb-2">
          Code: `public/index.php` (Add Alpine.js CDN & Modify Body)
        </h3>
        <p>
          Add the Alpine.js CDN script tag to the `&lt;head&gt;` section of
          `public/index.php`:
        </p>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-html"><!-- Inside <head> in public/index.php -->
&lt;script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"&gt;&lt;/script&gt;
</code></pre>
        <p>
          Modify the main `div` and the task list `ul` within the `&lt;body&gt;`
          of `public/index.php`:
        </p>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/index.php
require_once __DIR__ . '/../includes/functions.php';

// --- Form Handling for ADDING tasks (still uses POST/Redirect/Get) ---
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'add') {
    if (!empty($_POST['task_title'])) {
        addTask($_POST['task_title']);
    }
    header("Location: index.php"); // Redirect after adding
    exit;
}
// Note: Deleting/Toggling will now be handled by api.php via Alpine.js

// --- Initial Data Fetching ---
$initialTasks = getAllTasks(); // Fetch tasks only on initial page load

?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;!-- ... meta, title, tailwind ... --&gt;
    &lt;script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"&gt;&lt;/script&gt;
    &lt;title&gt;Todo App - Alpine.js&lt;/title&gt;
&lt;/head&gt;
&lt;body class="bg-gray-100"&gt;
    &lt;!-- Wrap the main content in an Alpine component --&gt;
    &lt;div
        class="container mx-auto max-w-lg mt-10 bg-white p-6 rounded shadow-md"
        x-data="{ tasks: &lt;?php echo json_encode($initialTasks); ?&gt;, newTaskTitle: '' }"
    &gt;
        &lt;h1 class="text-2xl font-bold mb-4 text-center"&gt;My Tasks (Alpine.js)&lt;/h1&gt;

        &lt;!-- Task Input Form --&gt;
        &lt;form action="index.php" method="POST" class="mb-4"&gt;
            &lt;input type="hidden" name="action" value="add"&gt;
            &lt;input type="text" name="task_title" placeholder="Add a new task" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300" required x-model="newTaskTitle"&gt;
            &lt;button type="submit" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"&gt;
                Add Task (Reloads)
            &lt;/button&gt;
        &lt;/form&gt;

        &lt;!-- Task List --&gt;
        &lt;ul&gt;
            &lt;template x-for="task in tasks" :key="task.id"&gt;
                &lt;li class="flex justify-between items-center p-2 border-b border-gray-200"&gt;
                    &lt;span :class="{ 'line-through text-gray-500': task.completed }" x-text="task.title"&gt;&lt;/span&gt;
                    &lt;div class="flex space-x-2"&gt;
                        &lt;button @click="toggleTask(task)" :class="task.completed ? 'text-gray-400' : 'text-green-500'" class="hover:text-green-700"&gt;✓&lt;/button&gt;
                        &lt;button @click="deleteTask(task.id)" class="text-red-500 hover:text-red-700"&gt;✗&lt;/button&gt;
                    &lt;/div&gt;
                &lt;/li&gt;
            &lt;/template&gt;
            &lt;template x-if="tasks.length === 0"&gt;
                &lt;li class="text-gray-500 text-center p-2"&gt;No tasks yet! Add one above.&lt;/li&gt;
            &lt;/template&gt;
        &lt;/ul&gt;

        &lt;!-- Alpine.js Logic --&gt;
        &lt;script&gt;
            document.addEventListener('alpine:init', () =&gt; {
                Alpine.data('tasks', () =&gt; ({
                    toggleTask(task) {
                        const index = this.tasks.findIndex(t => t.id === task.id);
                        if (index === -1) return;
                        const originalCompleted = this.tasks[index].completed;
                        // Optimistically update UI
                        this.tasks[index].completed = !this.tasks[index].completed;

                        const formData = new FormData();
                        formData.append('action', 'toggle');
                        formData.append('task_id', task.id);

                        fetch('api.php', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => {
                            if (!response.ok) {
                                console.error('API Error:', response.statusText);
                                this.tasks[index].completed = originalCompleted;
                                alert('Failed to update task status.');
                            }
                        })
                        .catch(error => {
                            console.error('Fetch Error:', error);
                                this.tasks[index].completed = originalCompleted;
                                alert('Failed to update task status.');
                        });
                    },

                    deleteTask(taskId) {
                        if (!confirm('Are you sure you want to delete this task?')) return;
                        const index = this.tasks.findIndex(t => t.id === taskId);
                        if (index === -1) return;
                        const removedTask = this.tasks.splice(index, 1)[0];

                        const formData = new FormData();
                        formData.append('action', 'delete');
                        formData.append('task_id', taskId);

                        fetch('api.php', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => {
                            if (!response.ok) {
                                console.error('API Error:', response.statusText);
                                this.tasks.splice(index, 0, removedTask);
                                alert('Failed to delete task.');
                            }
                        })
                        .catch(error => {
                            console.error('Fetch Error:', error);
                                this.tasks.splice(index, 0, removedTask);
                                alert('Failed to delete task.');
                        });
                    }
                }));
            });
        &lt;/script&gt;

    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Code: `public/api.php`</h3>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/api.php

// Include functions (adjust path as needed)
require_once __DIR__ . '/../includes/functions.php';

// Basic API endpoint for handling AJAX requests
// We expect POST requests with an 'action' parameter

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])) {
    $action = $_POST['action'];
    $taskId = isset($_POST['task_id']) ? (int)$_POST['task_id'] : 0;

    // Set header to indicate JSON response (optional but good practice)
    // header('Content-Type: application/json'); // Uncomment if sending JSON back

    $success = false; // Flag to indicate success

    if ($taskId &gt; 0) {
            switch ($action) {
                case 'toggle':
                    // Call the existing toggle function
                // In a real API, you might want connectDB() inside the function
                // or have the function return success/failure
                    toggleTask($taskId);
                // For this simple case, assume success if no DB error occurred
                    $success = true; // Assume success for now
                    break;

                case 'delete':
                    // Call the existing delete function
                    deleteTask($taskId);
                    $success = true; // Assume success for now
                    break;

                    // Add other actions like 'update_title' later if needed
        }
    }

    // Send a response (optional, could be simple status or JSON)
    if ($success) {
        // Send a minimal success response (HTTP 200 is default)
        // echo json_encode(['success' => true]); // Example JSON response
        http_response_code(200); // OK
    } else {
        // Send an error response code
        http_response_code(400); // Bad Request (or 500 Internal Server Error if DB failed)
        // echo json_encode(['success' => false, 'message' => 'Invalid request or task ID']);
    }

} else {
    // Not a POST request or action not set
    http_response_code(405); // Method Not Allowed
    // echo json_encode(['success' => false, 'message' => 'Invalid request method']);
}

exit; // Stop script execution

?&gt;
</code></pre>

        <p>
          Now, try toggling tasks. They should update instantly without a page
          reload! Deleting (with confirmation) should also work via AJAX if you
          implemented the `deleteTask` part in Alpine.js. Adding tasks still
          requires a page reload for now.
        </p>
      </div>

      <!-- Stage 5: User Authentication & Routing -->
      <div class="stage-section" id="stage-5">
        <h2 class="text-3xl mb-4">
          Stage 5: User Authentication & Routing (MPA)
        </h2>
        <p>
          Finally, let's turn this into a proper Multi-Page Application (MPA) by
          adding user accounts. Users should only see their own tasks. We'll
          need registration, login, logout functionality, and basic routing to
          handle different pages.
        </p>

        <h3 class="text-2xl mt-4 mb-2">Goals:</h3>
        <ul>
          <li>Add a `users` table to the database.</li>
          <li>
            Modify the `tasks` table to link tasks to users (add `user_id`).
          </li>
          <li>Implement user registration (hashing passwords!).</li>
          <li>Implement user login (verifying passwords).</li>
          <li>Use PHP sessions to manage logged-in state.</li>
          <li>
            Create separate pages/routes for login, registration, and the main
            task list (`index.php`).
          </li>
          <li>Implement logout functionality.</li>
          <li>
            Update database functions (`getAllTasks`, `addTask`, etc.) to be
            user-specific.
          </li>
          <li>
            Protect the main task page, redirecting unauthenticated users to the
            login page.
          </li>
        </ul>

        <h3 class="text-2xl mt-4 mb-2">File Structure (Stage 5):</h3>
        <pre><code>
project-root/
├── config/
│   └── database.php
├── includes/
│   ├── functions.php     <span class="text-yellow-400"><-- Modified for users & user-specific tasks</span>
│   ├── auth.php          <span class="text-lime-400"><-- New: Auth related functions (login, register, check session)</span>
│   └── header.php        <span class="text-lime-400"><-- New: Shared header content (nav, logout)</span>
│   └── footer.php        <span class="text-lime-400"><-- New: Shared footer content</span>
├── public/
│   ├── index.php         <span class="text-yellow-400"><-- Main task page (requires login)</span>
│   ├── login.php         <span class="text-lime-400"><-- New: Login page</span>
│   ├── register.php      <span class="text-lime-400"><-- New: Registration page</span>
│   ├── logout.php        <span class="text-lime-400"><-- New: Handles logout process</span>
│   └── api.php           <span class="text-yellow-400"><-- Modified to check user session</span>
└── .htaccess             <span class="text-gray-500"><-- (Optional: Could add rewrite rules for cleaner URLs)</span>
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">Database Setup (phpMyAdmin):</h3>
        <ol class="list-decimal ml-6 mb-4">
          <li>
            Go back to phpMyAdmin and select your `todoist_clone_db` database.
          </li>
          <li>Run the following SQL script to regenarate the entire database with some tasks and test users:</li>
        </ol>
        <pre>
<button class="copy-button" x-data="{}" @click="
    const codeElement = $event.target.closest('pre').querySelector('code');
    navigator.clipboard.writeText(codeElement.innerText).then(() => {
        $event.target.innerText = 'Copied!';
        $event.target.classList.add('copied');
        setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
    }).catch(err => console.error('Copy failed', err));
">Copy</button><code class="language-sql">-- ======================================================================
  -- !! EXTREMELY DESTRUCTIVE SCRIPT !!
  -- This script DROPS the ENTIRE database named 'todoist_clone_db'
  -- and recreates it from scratch, including test users and tasks.
  --
  -- Hashes for the password 'password' have been pre-calculated.
  --
  -- USE WITH EXTREME CAUTION, ONLY IN DEVELOPMENT ENVIRONMENTS.
  -- VERIFY THE DATABASE NAME BEFORE RUNNING.
  -- ======================================================================
  
  -- Specify the database to drop and create
  SET @db_name = 'todoist_clone_db';
  
  -- Drop the entire database if it exists
  DROP DATABASE IF EXISTS `todoist_clone_db`; -- Use the actual name directly here
  
  -- Create the database again with recommended settings
  CREATE DATABASE `todoist_clone_db` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; -- Use the actual name directly here
  
  -- Switch to the newly created database context
  USE `todoist_clone_db`; -- Use the actual name directly here
  
  -- ======================================================================
  -- Schema Creation within the new database
  -- ======================================================================
  
  -- Create the 'users' table
  CREATE TABLE `users` (
      `id` INT AUTO_INCREMENT PRIMARY KEY,
      `username` VARCHAR(50) NOT NULL UNIQUE,
      `password` VARCHAR(255) NOT NULL COMMENT 'Stores hashed passwords',
      `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
  
  -- Create the 'tasks' table
  CREATE TABLE `tasks` (
      `id` INT AUTO_INCREMENT PRIMARY KEY,
      `user_id` INT NOT NULL COMMENT 'Foreign key referencing users.id',
      `title` VARCHAR(255) NOT NULL,
      `completed` BOOLEAN DEFAULT FALSE, -- Or TINYINT(1) DEFAULT 0
      `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      CONSTRAINT `fk_user_id`
          FOREIGN KEY (`user_id`) REFERENCES `users`(`id`)
          ON DELETE CASCADE -- Delete tasks if the associated user is deleted
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
  
  -- ======================================================================
  -- Data Population
  -- ======================================================================
  
  -- Insert test users with PRE-HASHED passwords for 'password'
  -- NOTE: Hashes are different due to unique salts generated by password_hash()
  INSERT INTO `users` (`username`, `password`) VALUES
  ('testuser1', '$2y$17$UEyWPZsVCYOUtBco7rBgxuflogLgoAufEyhlPtbj5kcAw6.kyfvwK'), -- Hash for 'password'
  ('testuser2', '$2y$17$UEyWPZsVCYOUtBco7rBgxuflogLgoAufEyhlPtbj5kcAw6.kyfvwK'); -- Hash for 'password'
  
  -- NOTE: We assume here that 'testuser1' gets id=1 and 'testuser2' gets id=2
  -- This is generally true for a fresh table with AUTO_INCREMENT starting at 1.
  
  -- Insert sample tasks for test users
  INSERT INTO `tasks` (`user_id`, `title`, `completed`) VALUES
  -- Tasks for user 1 (assuming id=1)
  (1, 'Buy milk and eggs', 0),        -- 0 = FALSE
  (1, 'Finish project report', 0),
  (1, 'Call the bank', 1),            -- 1 = TRUE
  -- Tasks for user 2 (assuming id=2)
  (2, 'Schedule team meeting', 0),
  (2, 'Review design mockups', 0),
  (2, 'Prepare presentation slides', 0),
  (2, 'Book flight tickets', 1);
  
  -- ======================================================================
  -- Database Reset and Rebuild Complete
  -- ======================================================================
  
  SELECT 'Database todoist_clone_db dropped and rebuilt successfully.' AS status;
  SELECT COUNT(*) AS user_count FROM users;
  SELECT COUNT(*) AS task_count FROM tasks;
</code></pre>

        <h3 class="text-2xl mt-4 mb-2">
          Code Snippets (Placeholders & Structure):
        </h3>

        <p>
          We'll create new files and modify existing ones. Below are structural
          placeholders. You would fill in the logic using PHP sessions
          (`session_start()`, `$_SESSION`), password hashing (`password_hash()`,
          `password_verify()`), and updated database queries.
        </p>

        <h4 class="text-xl mt-3 mb-1">`includes/auth.php` (New)</h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// includes/auth.php
require_once __DIR__ . '/../config/database.php';

// Start session on any page that uses authentication
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

function registerUser($username, $password) {
    // 1. Connect to DB
    // 2. Check if username already exists
    // 3. Hash the password using password_hash()
    // 4. Insert new user into 'users' table
    // 5. Return true on success, false on failure (or error message)
    /* ... Placeholder for registration logic ... */
    return false; // Placeholder
}

function loginUser($username, $password) {
    // 1. Connect to DB
    // 2. Find user by username
    // 3. If user found, verify password using password_verify()
    // 4. If password matches, store user ID and username in $_SESSION
    // 5. Return true on success, false on failure
    /* ... Placeholder for login logic ... */
    return false; // Placeholder
}

function logoutUser() {
    // 1. Unset all session variables: $_SESSION = array();
    // 2. Destroy the session: session_destroy();
    /* ... Placeholder for logout logic ... */
}

function isLoggedIn() {
    // Check if user ID is set in the session
    return isset($_SESSION['user_id']);
}

function requireLogin() {
    // If user is not logged in, redirect to login page
    if (!isLoggedIn()) {
        header('Location: login.php');
        exit;
    }
}

function getCurrentUserId() {
    // Get the logged-in user's ID from the session
    return $_SESSION['user_id'] ?? null;
}

?&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">
          `includes/functions.php` (Modify Task Functions)
        </h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// includes/functions.php
require_once __DIR__ . '/../config/database.php';
// We might need auth functions here too, or include auth.php
require_once __DIR__ . '/auth.php'; // Make sure session is started

// Modify functions to accept and use user_id
function getAllTasks($userId) { // Add $userId parameter
    if (!$userId) return []; // Return empty if no user ID
    $conn = connectDB();
    $tasks = [];
    // Modify SQL to filter by user_id
    $sql = "SELECT id, title, completed FROM tasks WHERE user_id = ? ORDER BY created_at DESC";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("i", $userId); // Bind user ID parameter
    $stmt->execute();
    $result = $stmt->get_result();
    if ($result) {
        $tasks = $result->fetch_all(MYSQLI_ASSOC);
    }
    $stmt->close();
    $conn->close();
    return $tasks;
}

function addTask($title, $userId) { // Add $userId parameter
     if (!$userId || empty(trim($title))) return;
     $conn = connectDB();
     // Use prepared statements to prevent SQL injection
     $sql = "INSERT INTO tasks (title, user_id) VALUES (?, ?)";
     $stmt = $conn->prepare($sql);
     $stmt->bind_param("si", $title, $userId); // 's' for string, 'i' for integer
     $stmt->execute();
        $stmt->close();
        $conn->close();
}

function deleteTask($taskId, $userId) { // Add $userId parameter
    if (!$userId || !$taskId) return;
    $conn = connectDB();
    // Add user_id check to ensure users can only delete their own tasks
    $sql = "DELETE FROM tasks WHERE id = ? AND user_id = ?";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("ii", $taskId, $userId);
    $stmt->execute();
    // Check affected rows if needed: $stmt->affected_rows > 0
        $stmt->close();
        $conn->close();
}

function toggleTask($taskId, $userId) { // Add $userId parameter
    if (!$userId || !$taskId) return;
    $conn = connectDB();
    // Add user_id check
    $sql = "UPDATE tasks SET completed = NOT completed WHERE id = ? AND user_id = ?";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("ii", $taskId, $userId);
    $stmt->execute();
        $stmt->close();
        $conn->close();
}
?&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">`includes/header.php` (New)</h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// includes/header.php
// Ensure session is started (might be done in auth.php already)
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;
    &lt;!-- Include Alpine only on pages that need it (index.php) --&gt;
    &lt;?php if (basename($_SERVER['PHP_SELF']) == 'index.php'): ?&gt;
        &lt;script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"&gt;&lt;/script&gt;
    &lt;?php endif; ?&gt;
    &lt;title&gt;&lt;?php echo $pageTitle ?? 'Todo App'; // Allow setting page title &gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body class="bg-gray-100"&gt;
    &lt;nav class="bg-blue-600 text-white p-4 mb-6"&gt;
        &lt;div class="container mx-auto flex justify-between items-center"&gt;
            &lt;a href="index.php" class="text-xl font-bold"&gt;Todoist Clone&lt;/a&gt;
            &lt;div&gt;
                &lt;?php if (isset($_SESSION['user_id'])): ?&gt;
                    &lt;span class="mr-4"&gt;Welcome, &lt;?php echo htmlspecialchars($_SESSION['username'] ?? 'User'); ?>&lt;/span&gt;
                    &lt;a href="logout.php" class="hover:underline"&gt;Logout&lt;/a&gt;
                &lt;?php else: ?&gt;
                    &lt;a href="login.php" class="hover:underline mr-4"&gt;Login&lt;/a&gt;
                    &lt;a href="register.php" class="hover:underline"&gt;Register&lt;/a&gt;
                &lt;?php endif; ?&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/nav&gt;
    &lt;!-- Main content starts after this in each page --&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">`includes/footer.php` (New)</h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// includes/footer.php
?&gt;
    &lt;!-- Main content ends before this --&gt;
    &lt;footer class="text-center text-gray-500 text-sm mt-10 mb-4"&gt;
        © &lt;?php echo date('Y'); ?> Todoist Clone Tutorial
    &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">`public/login.php` (New)</h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/login.php
require_once __DIR__ . '/../includes/auth.php';

$error = ''; // Variable to hold error messages

// Redirect if already logged in
if (isLoggedIn()) {
    header('Location: index.php');
    exit;
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = $_POST['username'] ?? '';
    $password = $_POST['password'] ?? '';

        if (loginUser($username, $password)) {
            // Redirect to the main task page on successful login
            header('Location: index.php');
            exit;
        } else {
            // Set error message for display
            $error = "Invalid username or password.";
    }
}

$pageTitle = "Login"; // For header
include __DIR__ . '/../includes/header.php';
?&gt;

&lt;div class="container mx-auto max-w-sm mt-10"&gt;
    &lt;div class="bg-white p-6 rounded shadow-md"&gt;
        &lt;h1 class="text-2xl font-bold mb-4 text-center"&gt;Login&lt;/h1&gt;

        &lt;?php if ($error): ?&gt;
            &lt;div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert"&gt;
                &lt;span class="block sm:inline"&gt;&lt;?php echo $error; ?&gt;&lt;/span&gt;
            &lt;/div&gt;
        &lt;?php endif; ?&gt;

        &lt;form action="login.php" method="POST"&gt;
            &lt;div class="mb-4"&gt;
                &lt;label for="username" class="block text-gray-700 text-sm font-bold mb-2"&gt;Username:&lt;/label&gt;
                &lt;input type="text" name="username" id="username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required&gt;
            &lt;/div&gt;
            &lt;div class="mb-6"&gt;
                &lt;label for="password" class="block text-gray-700 text-sm font-bold mb-2"&gt;Password:&lt;/label&gt;
                &lt;input type="password" name="password" id="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required&gt;
            &lt;/div&gt;
            &lt;div class="flex items-center justify-between"&gt;
                &lt;button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"&gt;
          Sign In
                &lt;/button&gt;
                &lt;a class="inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800" href="register.php"&gt;
          Need an account?
                &lt;/a&gt;
            &lt;/div&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;?php include __DIR__ . '/../includes/footer.php'; ?&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">`public/register.php` (New)</h4>
        <p>
          Structure similar to `login.php`, but calls `registerUser()` and
          handles registration-specific errors/success messages.
        </p>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/register.php
require_once __DIR__ . '/../includes/auth.php';

$error = '';
$success = '';

// Redirect if logged in
if (isLoggedIn()) {
    header('Location: index.php');
    exit;
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get username, password, maybe confirm_password
    // Validate input (e.g., password match, length)
    // If valid, call registerUser()
    // Set $success or $error message
    /* ... Placeholder for registration form handling ... */
    $error = "Registration logic not implemented."; // Placeholder
}

$pageTitle = "Register";
include __DIR__ . '/../includes/header.php';
?&gt;
&lt;!-- HTML Form similar to login, with fields for username, password, confirm password --&gt;
&lt;!-- Display $error or $success messages --&gt;
&lt;div class="container mx-auto max-w-sm mt-10"&gt;
    &lt;!-- Registration form structure here... --&gt;
    &lt;p class="text-center mt-4"&gt;Registration form placeholder. &lt;a href="login.php" class="text-blue-500 hover:underline"&gt;Already have an account?&lt;/a&gt;&lt;/p&gt;
    &lt;?php if ($error): ?&gt;&lt;p class="text-red-500 text-center"&gt;&lt;?php echo $error; ?&gt;&lt;/p&gt;&lt;?php endif; ?&gt;
    &lt;?php if ($success): ?&gt;&lt;p class="text-green-500 text-center"&gt;&lt;?php echo $success; ?&gt;&lt;/p&gt;&lt;?php endif; ?&gt;
&lt;/div&gt;

&lt;?php include __DIR__ . '/../includes/footer.php'; ?&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">`public/logout.php` (New)</h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/logout.php
require_once __DIR__ . '/../includes/auth.php';

logoutUser(); // Call the logout function

// Redirect to login page after logout
header('Location: login.php');
exit;
?&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">
          `public/index.php` (Modify for Auth & User Tasks)
        </h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php">
&lt;?php
// public/index.php
require_once __DIR__ . '/../includes/auth.php'; // Auth first
require_once __DIR__ . '/../includes/functions.php'; // Then functions

requireLogin(); // Redirect to login if not authenticated

$userId = getCurrentUserId(); // Get logged-in user's ID

// Handle ADD task form submission (user-specific)
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'add') {
    if (!empty($_POST['task_title']) && $userId) {
        addTask($_POST['task_title'], $userId); // Pass user ID
    }
    header("Location: index.php"); // PRG pattern
             exit;
}

// Fetch only the current user's tasks
$initialTasks = getAllTasks($userId);

$pageTitle = "My Tasks";
include __DIR__ . '/../includes/header.php'; // Include shared header
?&gt;

&lt;!-- Alpine.js x-data component (keep similar structure) --&gt;
&lt;div
    class="container mx-auto max-w-lg mt-10 bg-white p-6 rounded shadow-md"
    x-data="{ tasks: &lt;?php echo htmlspecialchars(json_encode($initialTasks), ENT_QUOTES, 'UTF-8'); ?&gt;, newTaskTitle: '' }"
&gt;
    &lt;h1 class="text-2xl font-bold mb-4 text-center"&gt;My Tasks&lt;/h1&gt;

    &lt;!-- Add Task Form (no change needed here, PHP handles user ID) --&gt;
    &lt;form action="index.php" method="POST" class="mb-4"&gt;
        &lt;!-- ... form content ... --&gt;
    &lt;/form&gt;

    &lt;!-- Task List (no change needed here, Alpine gets user-specific tasks via PHP) --&gt;
    &lt;ul&gt;
        &lt;!-- Alpine template x-for loop remains the same --&gt;
        &lt;template x-for="task in tasks" :key="task.id"&gt;
            &lt;!-- ... li structure with toggle/delete buttons ... --&gt;
                &lt;li class="flex justify-between items-center p-2 border-b border-gray-200"&gt;
                &lt;span :class="{ 'line-through text-gray-500': task.completed }" x-text="task.title"&gt;&lt;/span&gt;
                &lt;div class="flex space-x-2"&gt;
                    &lt;button @click="toggleTask(task)" :class="task.completed ? 'text-gray-400' : 'text-green-500'" class="hover:text-green-700"&gt;✓&lt;/button&gt;
                    &lt;button @click="deleteTask(task.id)" class="text-red-500 hover:text-red-700"&gt;✗&lt;/button&gt;
                &lt;/div&gt;
            &lt;/li&gt;
        &lt;/template&gt;
        &lt;!-- ... no tasks message ... --&gt;
        &lt;template x-if="tasks.length === 0"&gt;
                &lt;li class="text-gray-500 text-center p-2"&gt;No tasks yet! Add one above.&lt;/li&gt;
        &lt;/template&gt;
    &lt;/ul&gt;

    &lt;!-- Alpine.js Logic (toggleTask/deleteTask need no changes as api.php handles user context) --&gt;
    &lt;script&gt;
        document.addEventListener('alpine:init', () =&gt; {
            Alpine.data('tasks', () =&gt; ({
                // tasks and newTaskTitle initialized in x-data
                toggleTask(task) {
                    // Same frontend logic as before
                    const index = this.tasks.findIndex(t =&gt; t.id === task.id);
                    if (index === -1) return;
                    const originalCompleted = this.tasks[index].completed;
                    this.tasks[index].completed = !this.tasks[index].completed;

                const formData = new FormData();
                    formData.append('action', 'toggle');
                    formData.append('task_id', task.id);

                    fetch('api.php', { method: 'POST', body: formData })
                        .then(response =&gt; { if (!response.ok) throw new Error('API Error'); })
                        .catch(error =&gt; {
                            console.error('Toggle Error:', error);
                            this.tasks[index].completed = originalCompleted; // Revert on error
                            alert('Failed to update task status.');
                        });
                },
                deleteTask(taskId) {
                    // Same frontend logic as before
                    if (!confirm('Are you sure?')) return;
                    const index = this.tasks.findIndex(t =&gt; t.id === taskId);
                if (index === -1) return;
                const removedTask = this.tasks.splice(index, 1)[0];

                    const formData = new FormData();
                    formData.append('action', 'delete');
                    formData.append('task_id', taskId);

                    fetch('api.php', { method: 'POST', body: formData })
                        .then(response =&gt; { if (!response.ok) throw new Error('API Error'); })
                        .catch(error =&gt; {
                            console.error('Delete Error:', error);
                            this.tasks.splice(index, 0, removedTask); // Revert on error
                                alert('Failed to delete task.');
                        });
                }
            }));
        });
    &lt;/script&gt;

&lt;/div&gt; &lt;!-- End Alpine component --&gt;

&lt;?php include __DIR__ . '/../includes/footer.php'; // Include shared footer ?&gt;
</code></pre>

        <h4 class="text-xl mt-3 mb-1">`public/api.php` (Modify for Auth)</h4>
        <pre><button class="copy-button" x-data="{}" @click="
          const codeElement = $event.target.closest('pre').querySelector('code');
          navigator.clipboard.writeText(codeElement.innerText).then(() => {
              $event.target.innerText = 'Copied!';
              $event.target.classList.add('copied');
              setTimeout(() => { $event.target.innerText = 'Copy'; $event.target.classList.remove('copied'); }, 2000);
          }).catch(err => console.error('Copy failed', err));
      ">Copy</button><code class="language-php"><?php
// public/api.php
require_once __DIR__ . '/../includes/auth.php'; // Auth first
require_once __DIR__ . '/../includes/functions.php';

// API requests must come from a logged-in user
if (!isLoggedIn()) {
    http_response_code(401); // Unauthorized
    echo json_encode(['success' => false, 'message' => 'Authentication required.']);
    exit;
}

$userId = getCurrentUserId(); // Get the current user's ID

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $userId) {
$action = $_POST['action'];
$taskId = isset($_POST['task_id']) ? (int)$_POST['task_id'] : 0;
$success = false;

    if ($taskId > 0) {
    switch ($action) {
        case 'toggle':
                // Call function with user ID check included
                toggleTask($taskId, $userId);
                $success = true; // Assume success if function doesn't throw error
            break;
        case 'delete':
                 // Call function with user ID check included
                deleteTask($taskId, $userId);
                $success = true; // Assume success
             break;
        }
    }

    if ($success) {
        http_response_code(200);
        // echo json_encode(['success' => true]); // Optional success response
    } else {
        http_response_code(400); // Bad Request or task not found/not owned
        // echo json_encode(['success' => false, 'message' => 'Invalid request or task ID.']);
    }

} else {
    http_response_code(400); // Bad Request if method isn't POST or action missing
}
exit;
?>
</code></pre>

        <p>
          With these changes (once fully implemented), you'll have a multi-page
          application where users can register, log in, and manage their own
          private task lists. Tasks are loaded and modified via PHP and the
          database, with Alpine.js providing a smoother frontend experience for
          toggling and deleting.
        </p>
      </div>

      <h2 class="text-3xl mt-12 mb-4">Conclusion & Next Steps</h2>
      <p>
        Congratulations! You've progressively built a Todoist clone, starting
        from static HTML and ending with a database-backed, interactive,
        multi-user application using PHP, MySQL, Tailwind CSS, and Alpine.js.
      </p>
      <p>From here, you could:</p>
      <ul>
        <li>Improve error handling and user feedback.</li>
        <li>Implement task editing (not just adding/deleting/toggling).</li>
        <li>Add features like due dates, priorities, or projects.</li>
        <li>Refine the UI/UX further.</li>
        <li>
          Implement "Add Task" using Alpine.js and the API instead of a full
          page reload.
        </li>
        <li>
          Explore more advanced routing techniques or a simple PHP router.
        </li>
        <li>
          Strengthen security (more robust input validation, CSRF protection).
        </li>
        <li>
          Learn about object-oriented PHP (OOP) to better organize your code.
        </li>
        <li>
          Consider using a PHP framework (like Laravel or Symfony) for larger
          projects.
        </li>
      </ul>
      <p>Keep practicing and building!</p>
    </div>
    <!-- End Container -->
  </body>
</html>
